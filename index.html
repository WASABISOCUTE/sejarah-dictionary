<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kamus Sejarah</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <h1>Kamus Sejarah</h1>

    <input id="search" placeholder="Jenis Bahasa Melayu / Bahasa Cina">

    <div id="filter">
        <select id="subjectFilter">
            <option value="">Semua Jenis</option>
            <option value="General">Jeneral</option>
            <option value="Negara">Negara</option>//å›½å®¶
            <option value="Isme">Isme</option>//ä¸»ä¹‰
            <option value="Profesion">Profesion</option>//èŒä¸š
            <option value="Perjanjian">Perjanjian</option>//æ¡çº¦
            <option value="Peristiwa">Peristiwa</option>//äº‹ä»¶
            <option value="Benda">Benda</option>//ç‰©å“
            <option value="Sistem">Sistem</option>//ä½“ç³»
            <option value="TingkahLaku">Tingkah Laku</option>//è¡Œä¸º
            <option value="Orang">Orang</option>//äººç‰©
            <option value="PartiPolitik">Parti Politik</option>//æ”¿å…š
            <option value="Kumpulan">Kumpulan</option>
            <option value="Sumber">Sumber</option>
        </select>
        <select id="sortSelect">
            <option value="">Lalai</option>
            <option value="az">A â†’ Z</option>
            <option value="za">Z â†’ A</option>
            <option value="marked">Ditanda</option>
        </select>
        <button id="clearFilter">Kosongkan Penapis</button>
        <button id="showMarkedBtn">â­ Tunjukkan Perkataan Ditanda</button>
        <button id="submitWordBtn">â• Hantar Perkataan</button>
    </div>

    <div id="submitWordForm" style="display:none;">
        <h3>Hantar Perkataan Baru</h3>
        <p>Sila pilih kategori dan isikan butiran (Tidak Wajib):</p>

        <label>Kategori:</label>
        <select id="submitCategory"></select>

        <label>Perkataan (Malay):</label>
        <input type="text" id="subMs" placeholder="Contoh: Kemerdekaan">

        <label>Perkataan (Chinese):</label>
        <input type="text" id="subCn" placeholder="Contoh: ç‹¬ç«‹">

        <label>Tahun:</label>
        <input type="text" id="subTahun" placeholder="Contoh: 1957">

        <label>Kawasan:</label>
        <input type="text" id="subKawasan" placeholder="Contoh: Tanah Melayu">

        <label>Maksud (Bahasa Melayu):</label>
        <textarea id="subMsDesc" rows="2"></textarea>

        <label>Maksud (ä¸­æ–‡):</label>
        <textarea id="subDesc" rows="2"></textarea>

        <label>Ringkasan Acara:</label>
        <textarea id="subRingkasan" rows="2"></textarea>

        <label>Proses Acara:</label>
        <textarea id="subProses" rows="2"></textarea>

        <label>Kakitangan yang berkaitan:</label>
        <input type="text" id="subPersonal" placeholder="Contoh: Tunku Abdul Rahman">

        <label>Contoh:</label>
        <textarea id="subExample" rows="2"></textarea>

        <button id="confirmSubmitWord">Hantar ke GitHub</button>
        <button id="cancelSubmitWord">Batal</button>
    </div>

    <div id="list"></div>

    <!-- ===== è¯¦æƒ…é¡µ ===== -->
    <div id="detail" style="display:none;">
        <button id="backBtn">â† Kembali</button>

        <h2>
            <span id="dMs"></span>
            <button id="pronounceBtn" title="Sebut">ğŸ”Š</button>
        </h2>
        <p id="dCn"></p>
        <div id="dTags"></div>

        <p><strong>Kategori:</strong> <span id="dCategory"></span></p>
        <p><strong>Kawasan:</strong> <span id="dKawasan"></span></p>
        <p><strong>ä¸­æ–‡:</strong> <span id="dDescription"></span></p>
        <p><strong>Bahasa Malayu:</strong> <span id="dMsDescription"></span></p>
        <p><strong>Ringkasan Acara:</strong> <span id="dRingkasanAcara"></span></p>
        <p><strong>Proses Acara:</strong> <span id="dEventProcess"></span></p>
        <p><strong>Kakitangan yang berkaitan:</strong> <span id="drelatedPersonnel"></span></p>
        <p><strong>Contoh:</strong> <span id="dExample"></span></p>
        <!-- å›¾ç‰‡ / Video / Link Container -->
        <div id="dMedia" style="margin-top: 15px;"></div>
        <div id="dLinks" style="margin-top: 10px;"></div>
        <!-- æ‰€å±åˆ†ç±» -->
        <p id="belongsBlock" class="detail-section"> <strong>æ‰€å±åˆ†ç±» / Kepunyaan:</strong> <span id="belongsList"></span>
        </p>
        <p id="classificationBlock" class="detail-section"><strong>åˆ†ç±»:</strong> <span id="classificationList"></span>
        </p>
        <p id="dSimilar"><strong>Perkataan Berkaitan:</strong></p>
        <button id="markDetailBtn">â˜† Tanda</button>
        <button id="reportBtn">âš ï¸ Lapor Ralat</button>
        <!-- æ›´æ–°æ—¶é—´ -->
        <div id="dUpdated" class="detail-updated"></div>

        <div id="reportForm" style="display:none;">
            <p>Sila isikan maklumat yang betul:</p>
            <textarea id="reportText" rows="4" placeholder="Masukkan Bahasa Melayu / Cina yang betul dll."></textarea>
            <button id="submitReport">Hantar</button>
            <button id="cancelReport">Batal</button>
        </div>
    </div>



    <!-- ===== ç½‘ç«™ä¿¡æ¯é¡µ ===== -->
    <div id="about" style="display:none;">
        <button id="aboutBackBtn">â† Kembali</button>

        <h2>ç½‘ç«™ä¿¡æ¯ / Maklumat Laman Web</h2>

        <section class="about-section">
            <h3>é¡¹ç›®ç®€ä»‹ / Mengenai</h3>
            <p>å†å²è¯å…¸æ˜¯ä¸€ä¸ªé¢å‘é©¬æ¥è¥¿äºšForm 4/Form 5 å­¦ç”Ÿçš„åœ¨çº¿å­¦ä¹ å·¥å…·ï¼Œç”¨äºå¿«é€ŸæŸ¥è¯¢å†å²ä¸­çš„é‡è¦æœ¯è¯­ã€‚</p>
            <p>Kamus Sejarah ialah alat pembelajaran dalam talian yang direka untuk pelajar Tingkatan 4/Tingkatan 5
                Malaysia, digunakan untuk mencari istilah penting dalam Sejarah dengan cepat..</p>
        </section>

        <section class="about-section">
            <h3>åˆ¶ä½œäººå‘˜ / Kredit</h3>
            <ul>
                <li><strong>é¡¹ç›®æ¦‚å¿µï¼š</strong> WASABISOCUTE</li>
                <li><strong>ç•Œé¢åŠåŠŸèƒ½è®¾è®¡ï¼š</strong> WASABISOCUTE</li>
                <li><strong>ä»£ç ï¼š</strong> <del>ChatGPT</del> Google Antigravity</li>
            </ul>
            <ul>
                <li><strong>Konsep Projek:</strong> WASABISOCUTE</li>
                <li><strong>Reka Bentuk UI dan Ciri:</strong> WASABISOCUTE</li>
                <li><strong>Bantuan Kod:</strong> <del>ChatGPT</del> Google Antigravity</li>
            </ul>
        </section>

        <section class="about-section">
            <h3>å¼€æºä¿¡æ¯ / Sumber Terbuka</h3>
            <p>æœ¬é¡¹ç›®æ‰˜ç®¡äº GitHubï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestã€‚</p>
            <p>Projek ini dihoskan di GitHub. Isu dan Permintaan Tarik dialu-alukan.</p>
        </section>

        <section class="about-section">
            <h3>
                è´¡çŒ®è€… / Penyumbang
                <span id="contributorsInfo" class="info-icon">i</span>
            </h3>
            <div id="contributorsTip" class="info-tooltip">
                æ•°æ®æ¥è‡ª GitHub API / Data diambil daripada API GitHub
            </div>
            <ul id="contributors">
                <li>Memuatkan...</li>
            </ul>
        </section>

        <section class="about-section">
            <h3>è®¡åˆ’æ·»åŠ åŠŸèƒ½ / Ciri-ciri yang Dirancang</h3>
            <ul>
                <li><strong>Akan ditambah</strong></li>
            </ul>
        </section>
    </div>

    <footer id="footer">
        <span id="aboutLink">ç½‘ç«™ä¿¡æ¯</span>
    </footer>

    <script src="data.js"></script>
    <script>
        const input = document.getElementById("search");
        const list = document.getElementById("list");
        const detail = document.getElementById("detail");
        const about = document.getElementById("about");

        const backBtn = document.getElementById("backBtn");
        const aboutBackBtn = document.getElementById("aboutBackBtn");
        const aboutLink = document.getElementById("aboutLink");

        const dMs = document.getElementById("dMs");
        const dCn = document.getElementById("dCn");
        const dTags = document.getElementById("dTags");
        const dCategory = document.getElementById("dCategory");
        const dDescription = document.getElementById("dDescription");
        const dMsDescription = document.getElementById("dMsDescription");
        const dExample = document.getElementById("dExample");
        const dKawasan = document.getElementById("dKawasan");
        const dRingkasanAcara = document.getElementById("dRingkasanAcara");
        const dEventProcess = document.getElementById("dEventProcess");
        const drelatedPersonnel = document.getElementById("drelatedPersonnel");
        const dSimilar = document.getElementById("dSimilar");
        const belongsBlock = document.getElementById("belongsBlock");
        const belongsList = document.getElementById("belongsList");
        const classificationBlock = document.getElementById("classificationBlock");
        const classificationList = document.getElementById("classificationList");

        const sortSelect = document.getElementById("sortSelect");
        const subjectFilter = document.getElementById("subjectFilter");
        const clearFilter = document.getElementById("clearFilter");
        const showMarkedBtn = document.getElementById("showMarkedBtn");
        const submitWordBtn = document.getElementById("submitWordBtn");
        const submitWordForm = document.getElementById("submitWordForm");
        const submitCategory = document.getElementById("submitCategory");
        // Form inputs
        const subMs = document.getElementById("subMs");
        const subCn = document.getElementById("subCn");
        const subTahun = document.getElementById("subTahun");
        const subKawasan = document.getElementById("subKawasan");
        const subMsDesc = document.getElementById("subMsDesc");
        const subDesc = document.getElementById("subDesc");
        const subRingkasan = document.getElementById("subRingkasan");
        const subProses = document.getElementById("subProses");
        const subPersonal = document.getElementById("subPersonal");
        const subExample = document.getElementById("subExample");

        const confirmSubmitWord = document.getElementById("confirmSubmitWord");
        const cancelSubmitWord = document.getElementById("cancelSubmitWord");

        const dUpdated = document.getElementById("dUpdated");

        const reportBtn = document.getElementById("reportBtn");
        const reportForm = document.getElementById("reportForm");
        const reportText = document.getElementById("reportText");
        const submitReport = document.getElementById("submitReport");
        const cancelReport = document.getElementById("cancelReport");

        const markDetailBtn = document.getElementById("markDetailBtn");

        let currentWord = null;
        let markedWords = JSON.parse(localStorage.getItem("markedWords") || "[]");
        let showingMarkedOnly = false;

        /* ===== æ ‡è®°é€»è¾‘ ===== */
        function updateMarkBtn(btn, ms) { btn.textContent = markedWords.includes(ms) ? "â˜…" : "â˜†"; }
        function toggleMark(ms) {
            if (markedWords.includes(ms)) markedWords = markedWords.filter(w => w !== ms);
            else markedWords.push(ms);
            localStorage.setItem("markedWords", JSON.stringify(markedWords));
        }
        function initMarkButtons() {
            document.querySelectorAll(".markBtn").forEach(btn => {
                const ms = btn.dataset.ms;
                updateMarkBtn(btn, ms);
                btn.onclick = e => {
                    e.stopPropagation();
                    toggleMark(ms);
                    updateMarkBtn(btn, ms);
                };
            });
        }



        /* ===== æ¸²æŸ“ ===== */

        function render(items) {
            list.innerHTML = "";
            items.forEach(w => {
                const div = document.createElement("div");
                div.className = "card";
                const parents = getParentCategories(w);

                div.innerHTML = `
      <h2>${w.ms} / ${w.cn}</h2>

      ${parents.length > 0
                        ? `<div class="belongs-text">
               å±äºï¼š${parents.map(p => `${p.ms}`).join(", ")}
             </div>`
                        : ""
                    }

      <div class="tags">
        ${(w.tags || []).map(t =>
                        `<span class="tag ${t}" data-tag="${t}">${t}</span>`
                    ).join("")}
      </div>

      <button class="markBtn" data-ms="${w.ms}">â˜†</button>
`;

                div.onclick = () => showDetail(w);
                list.appendChild(div);
            });
            initMarkButtons();
        }

        /* ===== è¯¦æƒ…é¡µ ===== */
        function showDetail(word) {
            currentWord = word;
            list.style.display = "none";
            about.style.display = "none";
            detail.style.display = "block";

            dMs.textContent = word.ms;
            dCn.textContent = word.cn;
            dTags.innerHTML = (word.tags || []).map(t => `<span class="tag ${t}" data-tag="${t}">${t}</span>`).join("");
            const setVisible = (el, val, isFormula = false) => {
                if (val && val !== "æ— ") {
                    el.parentElement.style.display = "block";
                    if (isFormula) el.innerHTML = `\\(${val}\\)`;
                    else el.textContent = val;
                } else {
                    el.parentElement.style.display = "none";
                }
            };

            setVisible(dCategory, word.category);
            setVisible(dDescription, word.Description);
            setVisible(dMsDescription, word.MsDescription);
            setVisible(dExample, word.example);
            setVisible(dKawasan, word.kawasan);
            setVisible(dRingkasanAcara, word.ringkasanAcara);
            setVisible(dEventProcess, word.eventProcess);
            /* Kakitangan yang berkaitan / Related Personnel */
            drelatedPersonnel.innerHTML = "";
            if (word.relatedPersonnel && word.relatedPersonnel !== "æ— ") {
                drelatedPersonnel.parentElement.style.display = "block";

                let people = [];
                if (Array.isArray(word.relatedPersonnel)) {
                    people = word.relatedPersonnel;
                } else {
                    people = word.relatedPersonnel.split(/,|ï¼Œ/).map(s => s.trim()).filter(s => s);
                }

                people.forEach(person => {
                    const btn = document.createElement("span");
                    btn.className = "tag";
                    btn.textContent = person;
                    btn.onclick = () => {
                        const target = words.find(w => w.ms === person);
                        if (target) {
                            showDetail(target);
                        } else {
                            input.value = person;
                            input.dispatchEvent(new Event('input'));
                        }
                    };
                    drelatedPersonnel.appendChild(btn);
                });
            } else {
                drelatedPersonnel.parentElement.style.display = "none";
            }

            /* ===== Image / Video / Links ===== */
            const dMedia = document.getElementById("dMedia");
            const dLinks = document.getElementById("dLinks");
            dMedia.innerHTML = "";
            dLinks.innerHTML = "";

            // Image
            if (word.image) {
                const img = document.createElement("img");
                img.src = word.image;
                img.style.maxWidth = "100%";
                img.style.borderRadius = "8px";
                img.style.marginTop = "10px";
                dMedia.appendChild(img);

                if (word.imageAlt) {
                    const caption = document.createElement("p");
                    caption.textContent = word.imageAlt;
                    caption.style.fontSize = "12px";
                    caption.style.color = "#888";
                    caption.style.marginTop = "4px";
                    dMedia.appendChild(caption);
                }
            }

            if (word.gif) {
                const gif = document.createElement("img");
                gif.src = word.gif;
                gif.style.maxWidth = "100%";
                gif.style.borderRadius = "8px";
                gif.style.marginTop = "10px";
                dMedia.appendChild(gif);
            }

            // Video (Loop if multiple logic needed, but simplifying for single field logic first. Or check if word.video is array)
            if (word.video) {
                const vidContainer = document.createElement("div");
                vidContainer.style.marginTop = "10px";

                if (word.video.includes("youtube.com") || word.video.includes("youtu.be")) {
                    const iframe = document.createElement("iframe");
                    iframe.width = "80%";
                    iframe.height = "300";
                    let videoId = "";
                    if (word.video.includes("youtu.be/")) {
                        videoId = word.video.split("youtu.be/")[1].split("?")[0];
                    } else if (word.video.includes("watch?v=")) {
                        videoId = word.video.split("watch?v=")[1].split("&")[0];
                    }

                    if (videoId) {
                        iframe.src = `https://www.youtube.com/embed/${videoId}`;
                    } else {
                        // å¦‚æœå·²ç»æ˜¯ embed é“¾æ¥æˆ–å…¶ä»–æ ¼å¼ / If already embed link or other format
                        iframe.src = word.video;
                    }
                    iframe.frameBorder = "0";
                    iframe.allow = "accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture";
                    iframe.allowFullscreen = true;
                    vidContainer.appendChild(iframe);
                } else {
                    const vid = document.createElement("video");
                    vid.src = word.video;
                    vid.controls = true;
                    vid.style.width = "100%";
                    vid.style.borderRadius = "8px";
                    vidContainer.appendChild(vid);
                }
                dMedia.appendChild(vidContainer);
            }

            // Links
            if (word.links && word.links.length > 0) {
                const ul = document.createElement("ul");
                ul.style.paddingLeft = "20px";
                word.links.forEach(l => {
                    const li = document.createElement("li");
                    const a = document.createElement("a");
                    a.href = l.url;
                    a.target = "_blank";
                    a.textContent = l.text || l.url;
                    a.style.color = "#60a5fa"; // Tailwind blue-400 equivalent match
                    li.appendChild(a);
                    ul.appendChild(li);
                });
                dLinks.innerHTML = "<strong>Pautan Berkaitan / ç›¸å…³é“¾æ¥:</strong>";
                dLinks.appendChild(ul);
            }

            dSimilar.innerHTML = "<strong>Perkataan Berkaitan:</strong> ";
            const simWords = word.similar || [];
            let hasSimilar = false;
            simWords.forEach(s => {
                const sw = words.find(w => w.ms === s);
                if (sw) {
                    hasSimilar = true;
                    const b = document.createElement("button");
                    b.textContent = sw.ms;
                    b.className = "tag";
                    b.onclick = () => showDetail(sw);
                    dSimilar.appendChild(b);
                }
            });

            dSimilar.style.display = hasSimilar ? "block" : "none";

            const pronounceBtn = document.getElementById("pronounceBtn");

            /*å‘éŸ³ */
            function pronounceWord(text) {
                if (!window.speechSynthesis) return;

                speechSynthesis.cancel(); // åœæ­¢ä¸Šä¸€æ¬¡å‘éŸ³

                const utter = new SpeechSynthesisUtterance(text);
                utter.lang = "ms-MY";
                utter.rate = 1;
                utter.pitch = 1;

                // ä¼˜å…ˆé€‰æ‹©è‹±æ–‡å£°éŸ³
                const voices = speechSynthesis.getVoices();
                const msVoice = voices.find(v => v.lang.startsWith("ms"));
                if (msVoice) utter.voice = msVoice;

                speechSynthesis.speak(utter);
            }

            pronounceBtn.onclick = () => {
                if (currentWord) {
                    pronounceWord(currentWord.ms);
                }
            };


            /* æ‰€å±åˆ†ç±» / Belongs to */
            belongsList.innerHTML = "";

            const parents = words.filter(w =>
                Array.isArray(w.classification) &&
                w.classification.some(c => c.ms === word.ms)
            );

            if (parents.length > 0) {
                belongsBlock.style.display = "block";

                parents.forEach(p => {
                    const tag = document.createElement("span");
                    tag.className = "tag";
                    tag.textContent = `${p.ms} / ${p.cn}`;

                    tag.onclick = () => showDetail(p);

                    belongsList.appendChild(tag);
                });
            } else {
                belongsBlock.style.display = "none";
            }

            /* åˆ†ç±» / Classification */
            classificationList.innerHTML = "";

            if (word.classification && word.classification.length > 0) {
                classificationBlock.style.display = "block";

                word.classification.forEach(item => {
                    const btn = document.createElement("span");
                    btn.className = "tag";
                    btn.textContent = `${item.ms} / ${item.cn}`;

                    btn.onclick = () => {
                        input.value = item.ms;
                        input.dispatchEvent(new Event('input'));
                    };

                    classificationList.appendChild(btn);
                });
            } else {
                classificationBlock.style.display = "none";
            }

            /* æ›´æ–°æ—¶é—´ */
            if (word.updated) {
                dUpdated.textContent = `Terakhir Dikemaskini: ${word.updated}`;
            } else {
                dUpdated.textContent = "Terakhir Dikemaskini: Tidak Diketahui";
            }

            updateMarkBtn(markDetailBtn, word.ms);
            MathJax.typesetPromise();
        }
        /* ===== åˆ—è¡¨ä¸­å±äº ===== */
        function getParentCategories(word) {
            return words.filter(w =>
                Array.isArray(w.classification) &&
                w.classification.some(c => c.ms === word.ms)
            );
        }

        /* ===== é¡µé¢åˆ‡æ¢ ===== */
        backBtn.onclick = () => { detail.style.display = "none"; list.style.display = "block"; }
        aboutLink.onclick = () => { list.style.display = "none"; detail.style.display = "none"; about.style.display = "block"; }
        aboutBackBtn.onclick = () => { about.style.display = "none"; list.style.display = "block"; }

        /* ===== æœç´¢ & ç­›é€‰ ===== */
        input.oninput = () => { const q = input.value.toLowerCase(); render(words.filter(w => w.ms.toLowerCase().includes(q) || w.cn.includes(q) || (w.tags || []).join("").toLowerCase().includes(q))); };
        function applyFilters() {
            let result = words;
            if (subjectFilter.value) result = result.filter(w => (w.tags || []).includes(subjectFilter.value));
            if (showingMarkedOnly) result = result.filter(w => markedWords.includes(w.ms));
            result = applySort(result);
            render(result);
        }
        sortSelect.addEventListener("change", applyFilters);
        subjectFilter.onchange = applyFilters;
        clearFilter.onclick = () => { subjectFilter.value = ""; showingMarkedOnly = false; showMarkedBtn.textContent = "â­ Tunjukkan Perkataan Ditanda"; render(words); };
        showMarkedBtn.onclick = () => { showingMarkedOnly = !showingMarkedOnly; showMarkedBtn.textContent = showingMarkedOnly ? "â­ Tunjukkan Semua Perkataan" : "â­ Tunjukkan Perkataan Ditanda"; applyFilters(); };
        markDetailBtn.onclick = () => { if (currentWord) { toggleMark(currentWord.ms); updateMarkBtn(markDetailBtn, currentWord.ms); } };
        /* ===== Hantar Perkataan ===== */
        // Populate Categories dynamically
        function initSubmitCategories() {
            submitCategory.innerHTML = "";
            Array.from(subjectFilter.options).forEach(opt => {
                if (opt.value) { // Skip "All"
                    const newOpt = document.createElement("option");
                    newOpt.value = opt.value;
                    newOpt.textContent = opt.textContent;
                    submitCategory.appendChild(newOpt);
                }
            });
        }
        initSubmitCategories();

        submitWordBtn.onclick = () => {
            initSubmitCategories(); // Populate categories each time the form is opened
            submitWordForm.style.display = "block";
            submitWordForm.scrollIntoView({ behavior: "smooth" });
        };
        cancelSubmitWord.onclick = () => {
            submitWordForm.style.display = "none";
            subMs.value = ""; subCn.value = ""; subTahun.value = ""; subKawasan.value = "";
            subMsDesc.value = ""; subDesc.value = ""; subRingkasan.value = "";
            subProses.value = ""; subPersonal.value = ""; subExample.value = "";
        };

        confirmSubmitWord.onclick = () => {
            const ms = subMs.value.trim();
            const cn = subCn.value.trim();

            if (ms || cn) {
                const repo = "https://github.com/WASABISOCUTE/sejarah-dictionary/issues/new";
                const cat = submitCategory.value;
                const title = encodeURIComponent(`Cadangan: ${ms} / ${cn}`);

                let bodyContent = `### Kategori\n${cat}\n\n`;
                bodyContent += `### Perkataan\n**Melayu:** ${ms}\n**Chinese:** ${cn}\n\n`;
                if (subTahun.value.trim()) bodyContent += `### Tahun\n${subTahun.value}\n\n`;
                if (subKawasan.value.trim()) bodyContent += `### Kawasan\n${subKawasan.value}\n\n`;
                if (subMsDesc.value.trim()) bodyContent += `### Bahasa Melayu Description\n${subMsDesc.value}\n\n`;
                if (subDesc.value.trim()) bodyContent += `### Chinese Description\n${subDesc.value}\n\n`;
                if (subRingkasan.value.trim()) bodyContent += `### Ringkasan Acara\n${subRingkasan.value}\n\n`;
                if (subProses.value.trim()) bodyContent += `### Proses Acara\n${subProses.value}\n\n`;
                if (subPersonal.value.trim()) bodyContent += `### Kakitangan yang berkaitan\n${subPersonal.value}\n\n`;
                if (subExample.value.trim()) bodyContent += `### Contoh\n${subExample.value}\n\n`;

                const body = encodeURIComponent(bodyContent);
                window.open(`${repo}?title=${title}&body=${body}`, "_blank");

                // Clear form
                submitWordForm.style.display = "none";
                subMs.value = ""; subCn.value = ""; subTahun.value = ""; subKawasan.value = "";
                subMsDesc.value = ""; subDesc.value = ""; subRingkasan.value = "";
                subProses.value = ""; subPersonal.value = ""; subExample.value = "";
            } else {
                alert("Sila masukkan sekurang-kurangnya nama perkataan.");
            }
        };

        /* ===== æ’åº ===== */
        function applySort(list) {
            const mode = sortSelect.value;
            const arr = [...list];

            if (mode === "az") {
                arr.sort((a, b) => a.ms.localeCompare(b.ms));
            }
            else if (mode === "za") {
                arr.sort((a, b) => b.ms.localeCompare(a.ms));
            }
            else if (mode === "marked") {
                arr.sort((a, b) => {
                    const aMarked = markedWords.includes(a.ms);
                    const bMarked = markedWords.includes(b.ms);
                    return bMarked - aMarked;
                });
            }

            return arr;
        }
        /* ===== æŠ¥é”™ ===== */
        reportBtn.onclick = () => reportForm.style.display = "block";
        cancelReport.onclick = () => reportForm.style.display = "none";
        submitReport.onclick = () => {
            if (currentWord && reportText.value.trim()) {
                const repo = "https://github.com/WASABISOCUTE/sejarah-dictionary/issues/new";
                const title = encodeURIComponent(`Laporan Ralat Kamus Sejarah: ${currentWord.ms}`);
                const body = encodeURIComponent(reportText.value);
                window.open(`${repo}?title=${title}&body=${body}`, "_blank");
                reportForm.style.display = "none"; reportText.value = "";
            }
        };

        /* ===== GitHub è´¡çŒ®è€… ===== */
        const contributorsList = document.getElementById("contributors");
        fetch("https://api.github.com/repos/WASABISOCUTE/sejarah-dictionary/contributors")
            .then(res => res.json())
            .then(data => {
                contributorsList.innerHTML = "";
                data.forEach(user => {
                    const li = document.createElement("li");
                    li.innerHTML = `<a href="${user.html_url}" target="_blank" style="color:#60a5fa;">${user.login}</a> ï¼ˆ${user.contributions} commitsï¼‰`;
                    contributorsList.appendChild(li);
                });
            }).catch(() => { contributorsList.innerHTML = "<li>Tidak dapat memuatkan senarai penyumbang</li>"; });

        /* ===== tooltip ä¿®å¤ ===== */
        const contributorsInfo = document.getElementById("contributorsInfo");
        const contributorsTip = document.getElementById("contributorsTip");
        let tipVisible = false;

        // ç‚¹å‡»åˆ‡æ¢æ˜¾ç¤º
        contributorsInfo.addEventListener("click", e => {
            e.stopPropagation();
            tipVisible = !tipVisible;
            contributorsTip.style.display = tipVisible ? "block" : "none";
        });

        // ç‚¹å‡»é¡µé¢å…¶ä»–åœ°æ–¹å…³é—­ tooltip
        document.addEventListener("click", () => {
            tipVisible = false;
            contributorsTip.style.display = "none";
        });

        /* ===== æ ‡ç­¾ç­›é€‰ ===== */
        document.body.addEventListener("click", e => {
            if (e.target.classList.contains("tag") && e.target.dataset.tag) {
                const tag = e.target.dataset.tag;
                render(words.filter(w => (w.tags || []).includes(e.target.dataset.tag)));
                detail.style.display = "none";
                list.style.display = "block";
            }
        });

        render(words);
    </script>
</body>



</html>

